# 缓存

## 分层架构
    由离用户距离，由近到远
    * 1. CDN 缓存层。 缓存视频， 图片， 文件等静态资源
    * 2. 反向代理缓存层。 
        varnish(内容存在内存中。快), 
        squid(文件存在硬盘上。慢)，
        nginx 缓存控件 文件存在硬盘上
    * 3. 本地应用缓存。 缓存在内存中。由应用程序自己控制。
    * 4. 分布式缓存层。 redis, memcached。
    * 5. 数据库层

## 数据一致性
    同步更新：
        先写数据库。再更新缓存。
    异步更新：
        数据库写操作和缓存写操作不一起完成。可以根据场景。定义一个延时间隔。

## 缓存穿透
    如果一个key没有命中缓存，那么就需要向数据库去请求。
    如果数据库里也没有。即结果为空的。那就会频繁的去数据库进行无效查询。
    那么需要做个策略来。采用布隆过滤器建立一个bitmap。查询时通过bitmap过滤。

## 缓存雪崩
    如果大面积缓存过期，大量请求透传到后端。代理系统性能急剧下降。
    可以由后台单独进程、线程。定期进行整体缓存更新任务。程序动态更新部分缓存。
    当系统缓存整体失效后，发送通知，开启缓存后台更新进程，线程。

## 缓存高可用
    分布式缓存。实现数据海量缓存。
    复制。实现缓存数据节点的高可用

## 缓存热点
    部分数据请求频次比较高，那么这部分数据应该放到一个复制集中。由一群缓存集来负载均衡请求。
